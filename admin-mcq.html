<!DOCTYPE html>
<html>
<head>
  <title>MCQ Assignment Manager</title>
  <style>
    .form-group { margin: 10px 0; }
    .btn { padding: 8px 16px; margin: 5px; }
    .assignment-list { margin-top: 20px; }
    .question-item { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>ğŸ§  MCQ Assignment Manager</h2>
  
  <!-- Add New Question Form -->
  <div class="form-group">
    <input id="courseId" placeholder="CourseID (CRS0001)" />
    <input id="topicId" placeholder="TopicID (T0001)" />
    <input id="qId" placeholder="QuestionID (Q1)" />
  </div>
  
  <div class="form-group">
    <textarea id="question" placeholder="Question Text" rows="2"></textarea>
  </div>
  
  <div class="form-group">
    <input id="optA" placeholder="Option A" />
    <input id="optB" placeholder="Option B" />
  </div>
  
  <div class="form-group">
    <input id="optC" placeholder="Option C" />
    <input id="optD" placeholder="Option D" />
    <select id="correct">
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
    </select>
  </div>
  
  <button class="btn btn-primary" onclick="addMCQ()">â• Add Question</button>
  <button class="btn btn-secondary" onclick="loadAssignments()">ğŸ“‹ Load All</button>
  <button class="btn btn-info" onclick="loadStats()">ğŸ“Š Stats</button>
  
  <!-- Assignments List -->
  <div id="assignmentsList" class="assignment-list"></div>
  <div id="stats"></div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwbp2TRprxwMuUxjS1Yz1BGs6jQIaTAx30cfVD0daUPm8nvRLQm6OkGKkMqijaitsdBXQ/exec';
    
    async function apiCall(action, data = {}) {
      const params = new URLSearchParams({ action, ...data });
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        body: params
      });
      return await response.json();
    }
    
    async function addMCQ() {
      const data = {
        courseId: document.getElementById('courseId').value,
        topicId: document.getElementById('topicId').value,
        questionId: document.getElementById('qId').value,
        questionText: document.getElementById('question').value,
        optionA: document.getElementById('optA').value,
        optionB: document.getElementById('optB').value,
        optionC: document.getElementById('optC').value,
        optionD: document.getElementById('optD').value,
        correctOption: document.getElementById('correct').value
      };
      
      const result = await apiCall('addMCQAssignment', data);
      alert(result.message);
      if (result.status === 'success') {
        document.querySelectorAll('input, textarea').forEach(el => el.value = '');
      }
    }
    
    async function loadAssignments() {
      const result = await apiCall('getAllMCQAssignments');
      const list = document.getElementById('assignmentsList');
      if (result.status === 'success') {
        let html = `<h3>ğŸ“š ${result.totalAssignments} Assignments Found</h3>`;
        result.data.forEach(assignment => {
          html += `
            <div class="question-item">
              <h4>${assignment.CourseID} â†’ ${assignment.TopicID}</h4>
              ${assignment.Questions.map(q => 
                `<div>
                  <strong>Q: ${q.QuestionText}</strong><br>
                  A: ${q.OptionA} | B: ${q.OptionB} | C: ${q.OptionC} | D: ${q.OptionD}<br>
                  <small>âœ… Correct: ${q.CorrectOption}</small>
                  <button onclick="deleteQuestion('${assignment.CourseID}','${assignment.TopicID}','${q.QuestionID}')">âŒ Delete</button>
                </div>`
              ).join('')}
            </div>
          `;
        });
        list.innerHTML = html;
      }
    }
    
    async function deleteQuestion(courseId, topicId, questionId) {
      if (confirm('Delete this question?')) {
        const result = await apiCall('deleteMCQAssignment', {
          courseId, topicId, questionId
        });
        alert(result.message);
        loadAssignments();
      }
    }
    
    async function loadStats() {
      const result = await apiCall('getMCQStats');
      document.getElementById('stats').innerHTML = 
        `<div style="background:#f0f8ff;padding:15px;">
          ğŸ“Š Total Questions: ${result.data.totalQuestions}<br>
          âœ… Total Submissions: ${result.data.totalSubmissions}<br>
          ğŸ“ˆ Completion Rate: ${result.data.completionRate}%
        </div>`;
    }
  </script>
</body>
</html>
